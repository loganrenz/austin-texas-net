<script setup lang="ts">
/**
 * MapSpotDetail — Full detail panel for a selected map spot.
 *
 * Shows icon pin (matching the map and list), name, address, badges,
 * rating stars, known-for callout, and description.
 * Uses the shared useMapIcons() composable for icon SVG paths.
 */
import type { MapSpot, MapPageConfig } from '~/types/mapSpot'

const props = defineProps<{
  spot: MapSpot
  config: MapPageConfig
}>()

const emit = defineEmits<{
  back: []
}>()

const { getIconPaths } = useMapIcons()
const iconPaths = computed(() => getIconPaths(props.config.categoryIcon))

const stars = computed(() => {
  if (!props.spot.rating) return { full: 0, half: false, empty: 5 }
  const full = Math.floor(props.spot.rating)
  const half = props.spot.rating % 1 >= 0.5
  return { full, half, empty: 5 - full - (half ? 1 : 0) }
})
</script>

<template>
  <section class="mb-10 animate-fade-up">
    <UButton
      variant="link"
      color="neutral"
      size="sm"
      icon="i-lucide-arrow-left"
      label="Back to Rankings"
      class="text-xs font-bold uppercase tracking-widest mb-5"
      @click="emit('back')"
    />

    <div class="spot-detail-panel">
      <!-- Name + icon rank pin -->
      <div class="flex items-start gap-4 mb-4">
        <div v-if="spot.rank" class="spot-detail-pin">
          <div
            class="spot-detail-icon"
            :style="
              config.pinColor
                ? {
                    background: `linear-gradient(145deg, ${config.pinColor}, color-mix(in srgb, ${config.pinColor} 55%, #000))`,
                  }
                : undefined
            "
          >
            <!-- eslint-disable-next-line atx/no-inline-svg -- dynamic icon paths from useMapIcons() -->
            <svg
              class="spot-detail-svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2.2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path v-for="(d, i) in iconPaths" :key="i" :d="d" />
            </svg>
          </div>
          <span class="spot-detail-rank">{{ spot.rank }}</span>
        </div>
        <div class="min-w-0 flex-1">
          <h2 class="text-xl sm:text-2xl font-extrabold font-display leading-tight mb-1">
            {{ spot.name }}
          </h2>
          <p class="text-sm text-muted">{{ spot.address }}</p>
        </div>
      </div>

      <!-- Meta badges -->
      <div class="flex flex-wrap items-center gap-2 mb-5">
        <UBadge
          v-if="spot.neighborhood"
          :label="spot.neighborhood"
          color="neutral"
          variant="subtle"
          size="sm"
        />
        <UBadge
          v-if="spot.priceRange"
          :label="spot.priceRange"
          color="success"
          variant="subtle"
          size="sm"
        />
        <div v-if="spot.rating" class="flex items-center gap-1 ml-auto">
          <template v-for="i in stars.full" :key="`df${i}`">
            <!-- eslint-disable-next-line atx/no-raw-tailwind-colors -->
            <UIcon name="i-lucide-star" class="size-4 text-amber-400 fill-amber-400" />
          </template>
          <template v-if="stars.half">
            <!-- eslint-disable-next-line atx/no-raw-tailwind-colors -->
            <UIcon name="i-lucide-star-half" class="size-4 text-amber-400" />
          </template>
          <template v-for="i in stars.empty" :key="`de${i}`">
            <UIcon name="i-lucide-star" class="size-4 text-default/15" />
          </template>
          <span class="text-sm font-bold text-muted ml-1">{{ spot.rating }}</span>
        </div>
      </div>

      <!-- Known for -->
      <div v-if="spot.knownFor" class="spot-detail-known-for mb-5">
        <!-- eslint-disable-next-line atx/no-inline-svg -- dynamic icon paths from useMapIcons() -->
        <svg
          class="spot-detail-known-svg"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2.2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path v-for="(d, i) in iconPaths" :key="i" :d="d" />
        </svg>
        <div>
          <!-- eslint-disable-next-line atx/no-raw-tailwind-colors -->
          <span
            class="text-xs font-bold uppercase tracking-wider text-amber-600 dark:text-amber-400"
            >Known For</span
          >
          <!-- eslint-disable-next-line atx/no-raw-tailwind-colors -->
          <p class="text-sm font-semibold text-amber-800 dark:text-amber-300 mt-0.5">
            {{ spot.knownFor }}
          </p>
        </div>
      </div>

      <!-- Description -->
      <p v-if="spot.description" class="text-base text-muted leading-relaxed">
        {{ spot.description }}
      </p>
    </div>
  </section>
</template>

<!-- eslint-disable atx/no-style-block-layout -->
<style scoped>
.spot-detail-panel {
  padding: 20px 24px;
  border-radius: 16px;
  border: 1px solid var(--ui-border);
  background: var(--ui-bg);
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
}

:is(.dark) .spot-detail-panel {
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.2);
}

/* Icon pin — matches map and list */
.spot-detail-pin {
  position: relative;
  flex-shrink: 0;
}

.spot-detail-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 44px;
  height: 44px;
  border-radius: 50%;
  background: linear-gradient(145deg, #d97706, #7c2d12);
  box-shadow: 0 2px 8px rgba(217, 119, 6, 0.3);
}

.spot-detail-svg {
  width: 22px;
  height: 22px;
  color: white;
}

.spot-detail-rank {
  position: absolute;
  bottom: -3px;
  right: -5px;
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: 20px;
  height: 20px;
  padding: 0 4px;
  border-radius: 10px;
  background: white;
  color: #92400e;
  font-size: 11px;
  font-weight: 800;
  font-family: var(--font-display);
  line-height: 1;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.15);
}

:is(.dark) .spot-detail-rank {
  background: #1c1c1e;
  color: #fbbf24;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.5);
}

/* Known for callout */
.spot-detail-known-for {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  padding: 12px;
  border-radius: 12px;
  background: rgba(245, 158, 11, 0.08);
  border: 1px solid rgba(245, 158, 11, 0.2);
}

:is(.dark) .spot-detail-known-for {
  background: rgba(245, 158, 11, 0.06);
  border-color: rgba(245, 158, 11, 0.15);
}

.spot-detail-known-svg {
  width: 16px;
  height: 16px;
  color: #f59e0b;
  flex-shrink: 0;
  margin-top: 2px;
}
</style>
